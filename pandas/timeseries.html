
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Time series &#8212; QuantEcon DataScience</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/quantecon-book-theme.857ff391aaabaeb8c161d2309c375fe6.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">


    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="../_static/quantecon-book-theme.76bf49d7bbc59738cdb03766fad654af.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://datascience.quantecon.org/pandas/timeseries.html" />
    <link rel="shortcut icon" href="../_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Intermediate Plotting" href="matplotlib.html" />
    <link rel="prev" title="GroupBy" href="groupby.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Chase Coleman, Spencer Lyon, and Jesse Perla" />
<meta name="keywords" content="Python, QuantEcon, DataScience" />
<meta name="description" content=This website presents a series of lectures on programming, data science, and economics. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Time series"/>
<meta name="twitter:description" content="This website presents a series of lectures on programming, data science, and economics.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Time series" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://datascience.quantecon.org/pandas/timeseries.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a series of lectures on programming, data science, and economics." />
<meta property="og:site_name" content="QuantEcon DataScience" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="wrapper">

        <div class="main">

            <div class="page" id=pandas/timeseries>

                <div class="page__toc">

                    <div class="inner">

                        
                        <div class="page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#intro">
   Intro
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parsing-strings-as-dates">
   Parsing Strings as Dates
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-dates">
     Multiple Dates
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#date-formatting">
   Date Formatting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extracting-data">
   Extracting Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accessing-date-properties">
   Accessing Date Properties
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#leads-and-lags-df-shift">
   Leads and Lags:
   <code class="docutils literal notranslate">
    <span class="pre">
     df.shift
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rolling-computations-rolling">
   Rolling Computations:
   <code class="docutils literal notranslate">
    <span class="pre">
     .rolling
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changing-frequencies-resample">
   Changing Frequencies:
   <code class="docutils literal notranslate">
    <span class="pre">
     .resample
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optional-api-keys">
   Optional: API keys
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-1">
     Exercise 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-2">
     Exercise 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-3">
     Exercise 3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-4">
     Exercise 4
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-5">
     Exercise 5
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-6">
     Exercise 6
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-7">
     Exercise 7
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-8">
     Exercise 8
    </a>
   </li>
  </ul>
 </li>
</ul>

                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="../_static/datascience-logo.png" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="page__header">

                    <div class="page__header-copy">

                        <p class="page__header-heading"><a href="index.html">QuantEcon DataScience</a></p>

                        <p class="page__header-subheading">Time series</p>

                    </div>

                    <p class="page__header-authors">Chase Coleman, Spencer Lyon, and Jesse Perla</p>

                </div> <!-- .page__header -->



                
                <main class="page__content" role="main">
                    
                    <div>
                        
  <div class="section" id="time-series">
<h1>Time series<a class="headerlink" href="#time-series" title="Permalink to this headline">¶</a></h1>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="../python_fundamentals/functions.html"><span class="doc">Python functions</span></a></p></li>
<li><p><a class="reference internal" href="groupby.html"><span class="doc">GroupBy</span></a></p></li>
</ul>
<p><strong>Outcomes</strong></p>
<ul class="simple">
<li><p>Know how pandas handles dates</p></li>
<li><p>Understand how to parse strings into <code class="docutils literal notranslate"><span class="pre">datetime</span></code> objects</p></li>
<li><p>Know how to write dates as custom formatted strings</p></li>
<li><p>Be able to access day, month, year, etc. for a <code class="docutils literal notranslate"><span class="pre">DateTimeIndex</span></code> and
a column with <code class="docutils literal notranslate"><span class="pre">dtype</span></code> <code class="docutils literal notranslate"><span class="pre">datetime</span></code></p></li>
<li><p>Understand both rolling and re-sampling operations and the difference
between the two</p></li>
</ul>
<p><strong>Data</strong></p>
<ul class="simple">
<li><p>Bitcoin to USD exchange rates from March 2014 to the present</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment following line to install on colab</span>
<span class="c1">#! pip install qeds</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">quandl</span>
<span class="kn">import</span> <span class="nn">qeds</span>

<span class="c1"># see section on API keys at end of lecture!</span>
<span class="n">quandl</span><span class="o">.</span><span class="n">ApiConfig</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;QUANDL_AUTH&quot;</span><span class="p">,</span> <span class="s2">&quot;Dn6BtVoBhzuKTuyo6hbp&quot;</span><span class="p">)</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s2">&quot;2014-05-01&quot;</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="c1"># activate plot theme</span>
<span class="kn">import</span> <span class="nn">qeds</span>
<span class="n">qeds</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">mpl_style</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<p>pandas has extensive support for handling dates and times.</p>
<p>We will loosely refer to data with date or time information as time
series data.</p>
<p>In this lecture, we will cover the most useful parts of pandas’ time
series functionality.</p>
<p>Among these topics are:</p>
<ul class="simple">
<li><p>Parsing strings as dates</p></li>
<li><p>Writing <code class="docutils literal notranslate"><span class="pre">datetime</span></code> objects as (inverse operation of previous point)</p></li>
<li><p>Extracting data from a DataFrame or Series with date information in
the index</p></li>
<li><p>Shifting data through time (taking leads or lags)</p></li>
<li><p>Re-sampling data to a different frequency and rolling operations</p></li>
</ul>
<p>However, even more than with previous topics, we will skip a lot of the
functionality pandas offers, and we urge you to refer to the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/timeseries.html">official
documentation</a>
for more information.</p>
</div>
<div class="section" id="parsing-strings-as-dates">
<h2>Parsing Strings as Dates<a class="headerlink" href="#parsing-strings-as-dates" title="Permalink to this headline">¶</a></h2>
<p>When working with time series data, we almost always receive the data
with dates encoded as strings.</p>
<p>Hopefully, the date strings follow a structured format or pattern.</p>
<p>One common pattern is <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span></code>: 4 numbers for the year, 2 for the
month, and 2 for the day with each section separated by a <code class="docutils literal notranslate"><span class="pre">-</span></code>.</p>
<p>For example, we write Christmas day 2017 in this format as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">christmas_str</span> <span class="o">=</span> <span class="s2">&quot;2017-12-25&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>To convert a string into a time-aware object, we use the
<code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">christmas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">christmas_str</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The type of christmas is&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">christmas</span><span class="p">))</span>
<span class="n">christmas</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code> function is pretty smart at guessing the format
of the date…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;December 25, 2017&quot;</span><span class="p">,</span> <span class="s2">&quot;Dec. 25, 2017&quot;</span><span class="p">,</span>
             <span class="s2">&quot;Monday, Dec. 25, 2017&quot;</span><span class="p">,</span> <span class="s2">&quot;25 Dec. 2017&quot;</span><span class="p">,</span> <span class="s2">&quot;25th Dec. 2017&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pandas interprets </span><span class="si">{}</span><span class="s2"> as </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>However, sometimes we will need to give pandas a hint.</p>
<p>For example, that same time (midnight on Christmas) would be reported on
an Amazon transaction report as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">christmas_amzn</span> <span class="o">=</span> <span class="s2">&quot;2017-12-25T00:00:00+ 00 :00&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>If we try to pass this to <code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code>, it will fail.</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">christmas_amzn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To parse a date with this format, we need to specify the <code class="docutils literal notranslate"><span class="pre">format</span></code>
argument for <code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">amzn_strftime</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S+ 00 :00&quot;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">christmas_amzn</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">amzn_strftime</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Can you guess what <code class="docutils literal notranslate"><span class="pre">amzn_strftime</span></code> represents?</p>
<p>Let’s take a closer look at <code class="docutils literal notranslate"><span class="pre">amzn_strftime</span></code> and <code class="docutils literal notranslate"><span class="pre">christmas_amzn</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">amzn_strftime</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">christmas_amzn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that both of the strings have a similar form, but that instead of actual numerical values, <code class="docutils literal notranslate"><span class="pre">amzn_strftime</span></code> has <em>placeholders</em>.</p>
<p>Specifically, anywhere the <code class="docutils literal notranslate"><span class="pre">%</span></code> shows up is a signal to the <code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code>
function that it is where relevant information is stored.</p>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">%Y</span></code> is a stand-in for a four digit year, <code class="docutils literal notranslate"><span class="pre">%m</span></code> is
for 2 a digit month, and so on…</p>
<p>The official <a class="reference external" href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior">Python
documentation</a> contains a complete list of possible <code class="docutils literal notranslate"><span class="pre">%</span></code>something patterns that are accepted
in the <code class="docutils literal notranslate"><span class="pre">format</span></code> argument.</p>
<div class="admonition-exercise admonition" id="pd-tim-dir1">
<p class="admonition-title">Exercise</p>
<p>See exercise 1 in the <a class="reference internal" href="#pd-tim-ex"><span class="std std-ref">exercise list</span></a>.</p>
</div>
<div class="section" id="multiple-dates">
<h3>Multiple Dates<a class="headerlink" href="#multiple-dates" title="Permalink to this headline">¶</a></h3>
<p>If we have dates in a Series (e.g. column of DataFrame) or a list, we
can pass the entire collection to <code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code> and get a
collection of dates back.</p>
<p>We’ll just show an example of that here as the mechanics are the same as
a single date.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s2">&quot;2017-12-25&quot;</span><span class="p">,</span> <span class="s2">&quot;2017-12-31&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="date-formatting">
<h2>Date Formatting<a class="headerlink" href="#date-formatting" title="Permalink to this headline">¶</a></h2>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">%</span></code>pattern format to have pandas write <code class="docutils literal notranslate"><span class="pre">datetime</span></code>
objects as specially formatted strings using the <code class="docutils literal notranslate"><span class="pre">strftime</span></code> (string
format time) method.</p>
<p>For example,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">christmas</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;We love %A %B </span><span class="si">%d</span><span class="s2"> (also written </span><span class="si">%c</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-exercise admonition" id="pd-tim-dir2">
<p class="admonition-title">Exercise</p>
<p>See exercise 2 in the <a class="reference internal" href="#pd-tim-ex"><span class="std std-ref">exercise list</span></a>.</p>
</div>
</div>
<div class="section" id="extracting-data">
<h2>Extracting Data<a class="headerlink" href="#extracting-data" title="Permalink to this headline">¶</a></h2>
<p>When the index of a DataFrame has date information and pandas
recognizes the values as <code class="docutils literal notranslate"><span class="pre">datetime</span></code> values, we can leverage some
convenient indexing features for extracting data.</p>
<p>The flexibility of these features is best understood through example,
so let’s load up some data and take a look.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_usd</span> <span class="o">=</span> <span class="n">quandl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BCHARTS/BITSTAMPUSD&quot;</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">)</span>
<span class="n">btc_usd</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">btc_usd</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we have the Bitcoin (BTC) to US dollar (USD) exchange rate from
March 2014 until today.</p>
<p>Notice that the type of index is <code class="docutils literal notranslate"><span class="pre">DateTimeIndex</span></code>.</p>
<p>This is the key that enables things like…</p>
<p>Extracting all data for the year 2015 by passing <code class="docutils literal notranslate"><span class="pre">&quot;2015&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">.loc</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_usd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;2015&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We can also narrow down to specific months.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># By month&#39;s name</span>
<span class="n">btc_usd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;August 2017&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># By month&#39;s number</span>
<span class="n">btc_usd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;08/2017&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Or even a day…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># By date name</span>
<span class="n">btc_usd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;August 1, 2017&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># By date number</span>
<span class="n">btc_usd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;08-01-2017&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>What can we pass as the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> argument when we have a
<code class="docutils literal notranslate"><span class="pre">DateTimeIndex</span></code>?</p>
<p>Anything that can be converted to a <code class="docutils literal notranslate"><span class="pre">datetime</span></code> using
<code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code>, <em>without</em> having to specify the format argument.</p>
<p>When that condition holds, pandas will return <em>all</em> rows whose date in
the index “belong” to that date or period.</p>
<p>We can also use the range shorthand notation to give a start and end
date for selection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_usd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;April 1, 2015&quot;</span><span class="p">:</span><span class="s2">&quot;April 10, 2015&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-exercise admonition" id="pd-tim-dir3">
<p class="admonition-title">Exercise</p>
<p>See exercise 3 in the <a class="reference internal" href="#pd-tim-ex"><span class="std std-ref">exercise list</span></a>.</p>
</div>
</div>
<div class="section" id="accessing-date-properties">
<h2>Accessing Date Properties<a class="headerlink" href="#accessing-date-properties" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, we would like to directly access a part of the date/time.</p>
<p>If our date/time information is in the index, we can to <code class="docutils literal notranslate"><span class="pre">df.index.XX</span></code>
where <code class="docutils literal notranslate"><span class="pre">XX</span></code> is replaced by <code class="docutils literal notranslate"><span class="pre">year</span></code>, <code class="docutils literal notranslate"><span class="pre">month</span></code>, or whatever we would
like to access.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_usd</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_usd</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span>
</pre></div>
</div>
</div>
</div>
<p>We can also do the same if the date/time information is stored in a
column, but we have to use a slightly different syntax.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;column_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">XX</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_date_column</span> <span class="o">=</span> <span class="n">btc_usd</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">btc_date_column</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_date_column</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_date_column</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="leads-and-lags-df-shift">
<h2>Leads and Lags: <code class="docutils literal notranslate"><span class="pre">df.shift</span></code><a class="headerlink" href="#leads-and-lags-df-shift" title="Permalink to this headline">¶</a></h2>
<p>When doing time series analysis, we often want to compare data at one
date against data at another date.</p>
<p>pandas can help us with this if we leverage the <code class="docutils literal notranslate"><span class="pre">shift</span></code> method.</p>
<p>Without any additional arguments, <code class="docutils literal notranslate"><span class="pre">shift()</span></code> will move all data
<em>forward</em> one period, filling the first row with missing data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># so we can see the result of shift clearly</span>
<span class="n">btc_usd</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_usd</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can use this to compute the percent change from one day to the next.
(Quiz: Why does that work? Remember how pandas uses the index to <em>align</em>
data.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">btc_usd</span> <span class="o">-</span> <span class="n">btc_usd</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span> <span class="o">/</span> <span class="n">btc_usd</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Setting the first argument to <code class="docutils literal notranslate"><span class="pre">n</span></code> tells pandas to shift the data down
<code class="docutils literal notranslate"><span class="pre">n</span></code> rows (apply an <code class="docutils literal notranslate"><span class="pre">n</span></code> period lag).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_usd</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>A negative value will shift the data <em>up</em> or apply a lead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_usd</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_usd</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-exercise admonition" id="pd-tim-dir4">
<p class="admonition-title">Exercise</p>
<p>See exercise 4 in the <a class="reference internal" href="#pd-tim-ex"><span class="std std-ref">exercise list</span></a>.</p>
</div>
</div>
<div class="section" id="rolling-computations-rolling">
<h2>Rolling Computations: <code class="docutils literal notranslate"><span class="pre">.rolling</span></code><a class="headerlink" href="#rolling-computations-rolling" title="Permalink to this headline">¶</a></h2>
<p>pandas has facilities that enable easy computation of <em>rolling
statistics</em>.</p>
<p>These are best understood by example, so we will dive right in.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># first take only the first 6 rows so we can easily see what is going on</span>
<span class="n">btc_small</span> <span class="o">=</span> <span class="n">btc_usd</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">btc_small</span>
</pre></div>
</div>
</div>
</div>
<p>Below, we compute the 2 day moving average (for all columns).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_small</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To do this operation, pandas starts at each row (date) then looks
<em>backwards</em> the specified number of periods (here 2 days) and then
applies some aggregation function (<code class="docutils literal notranslate"><span class="pre">mean</span></code>) on all the data in that
window.</p>
<p>If pandas cannot look back the full length of the window (e.g. when
working on the first row), it fills as much of the window as possible
and then does the operation. Notice that the value at 2014-05-01 is
the same in both DataFrames.</p>
<p>Below, we see a visual depiction of the rolling maximum on a 21 day
window for the whole dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">btc_usd</span><span class="p">[</span><span class="s2">&quot;Open&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">btc_usd</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s2">&quot;21d&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()[</span><span class="s2">&quot;Open&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;Original&quot;</span><span class="p">,</span> <span class="s2">&quot;21 day max&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We can also ask pandas to <code class="docutils literal notranslate"><span class="pre">apply</span></code> custom functions, similar to what we
saw when studying GroupBy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">is_volatile</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;Returns a 1 if the variance is greater than 1, otherwise returns 0&quot;</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">var</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">btc_small</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_volatile</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-exercise admonition" id="pd-tim-dir5">
<p class="admonition-title">Exercise</p>
<p>See exercise 5 in the <a class="reference internal" href="#pd-tim-ex"><span class="std std-ref">exercise list</span></a>.</p>
</div>
<p>To make the optimal decision, we need to know the maximum
difference between the close price at the end of the window and the open
price at the start of the window.</p>
<div class="admonition-exercise admonition" id="pd-tim-dir6">
<p class="admonition-title">Exercise</p>
<p>See exercise 6 in the <a class="reference internal" href="#pd-tim-ex"><span class="std std-ref">exercise list</span></a>.</p>
</div>
</div>
<div class="section" id="changing-frequencies-resample">
<h2>Changing Frequencies: <code class="docutils literal notranslate"><span class="pre">.resample</span></code><a class="headerlink" href="#changing-frequencies-resample" title="Permalink to this headline">¶</a></h2>
<p>In addition to computing rolling statistics, we can also change the
frequency of the data.</p>
<p>For example, instead of a monthly moving average, suppose that we wanted
to compute the average <em>within</em> each calendar month.</p>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">resample</span></code> method to do this.</p>
<p>Below are some examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># business quarter</span>
<span class="n">btc_usd</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;BQ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Note that unlike with <code class="docutils literal notranslate"><span class="pre">rolling</span></code>, a single number is returned for
each column for each quarter.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">resample</span></code> method will alter the frequency of the data and the
number of rows in the result will be different from the number of rows
in the input.</p>
<p>On the other hand, with <code class="docutils literal notranslate"><span class="pre">rolling</span></code>, the size and frequency of the result
are the same as the input.</p>
<p>We can sample at other frequencies and aggregate with multiple aggregations
function at once.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># multiple functions at 2 start-of-quarter frequency</span>
<span class="n">btc_usd</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;2BQS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>As with <code class="docutils literal notranslate"><span class="pre">groupby</span></code> and <code class="docutils literal notranslate"><span class="pre">rolling</span></code>, you can also provide custom
functions to <code class="docutils literal notranslate"><span class="pre">.resample(...).agg</span></code> and <code class="docutils literal notranslate"><span class="pre">.resample(...).apply</span></code></p>
<div class="admonition-exercise admonition" id="pd-tim-dir7">
<p class="admonition-title">Exercise</p>
<p>See exercise 7 in the <a class="reference internal" href="#pd-tim-ex"><span class="std std-ref">exercise list</span></a>.</p>
</div>
<p>To make the optimal decision we need to, for each month,
compute the maximum value of the close price on any day minus the open
price on the first day of the month.</p>
<div class="admonition-exercise admonition" id="pd-tim-dir8">
<p class="admonition-title">Exercise</p>
<p>See exercise 8 in the <a class="reference internal" href="#pd-tim-ex"><span class="std std-ref">exercise list</span></a>.</p>
</div>
</div>
<div class="section" id="optional-api-keys">
<h2>Optional: API keys<a class="headerlink" href="#optional-api-keys" title="Permalink to this headline">¶</a></h2>
<p>Recall above that we had the line of code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">quandl</span><span class="o">.</span><span class="n">ApiConfig</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;Dn6BtVoBhzuKTuyo6hbp&quot;</span>
</pre></div>
</div>
<p>This line told the <code class="docutils literal notranslate"><span class="pre">quandl</span></code> library that when obtaining making requests for data, it should use the <em>API key</em> <code class="docutils literal notranslate"><span class="pre">Dn6BtVoBhzuKTuyo6hbp</span></code>.</p>
<p>An API key is a sort of password that web services (like the Quandl API) require you to provide when you make requests.</p>
<p>Using this password, we were able to make a request to Quandl to obtain data directly from them.</p>
<p>The API key used here is one that we requested on behalf of this course.</p>
<p>If you plan to use Quandl more extensively, you should obtain your own personal API key from <a class="reference external" href="https://docs.quandl.com/docs#section-authentication">their website</a> and re-run the <code class="docutils literal notranslate"><span class="pre">quandl.ApiConfig.api_key...</span></code> line of code with your new API key on the right-hand side.</p>
</div>
<div class="section" id="exercises">
<span id="pd-tim-ex"></span><h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<div class="section" id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h3>
<p>By referring to table found at the link above, figure out the correct argument to
pass as <code class="docutils literal notranslate"><span class="pre">format</span></code> in order to parse the dates in the next three cells below.</p>
<p>Test your work by passing your format string to <code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">christmas_str2</span> <span class="o">=</span> <span class="s2">&quot;2017:12:25&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dbacks_win</span> <span class="o">=</span> <span class="s2">&quot;M:11 D:4 Y:2001 9:15 PM&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">america_bday</span> <span class="o">=</span> <span class="s2">&quot;America was born on July 4, 1776&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>(<a class="reference internal" href="#pd-tim-dir1"><span class="std std-ref">back to text</span></a>)</p>
</div>
<div class="section" id="exercise-2">
<h3>Exercise 2<a class="headerlink" href="#exercise-2" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code> to express the birthday of one of your friends
or family members as a <code class="docutils literal notranslate"><span class="pre">datetime</span></code> object.</p>
<p>Then use the <code class="docutils literal notranslate"><span class="pre">strftime</span></code> method to write a message of the format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span><span class="s1">&#39;s birthday is June 10, 1989 (a Saturday)</span>
</pre></div>
</div>
<p>(where the name and date are replaced by the appropriate values)</p>
<p>(<a class="reference internal" href="#pd-tim-dir2"><span class="std std-ref">back to text</span></a>)</p>
</div>
<div class="section" id="exercise-3">
<h3>Exercise 3<a class="headerlink" href="#exercise-3" title="Permalink to this headline">¶</a></h3>
<p>For each item in the list, extract the specified data from <code class="docutils literal notranslate"><span class="pre">btc_usd</span></code>:</p>
<ul class="simple">
<li><p>July 2017 through August 2017 (inclusive)</p></li>
<li><p>April 25, 2015 to June 10, 2016</p></li>
<li><p>October 31, 2017</p></li>
</ul>
<p>(<a class="reference internal" href="#pd-tim-dir3"><span class="std std-ref">back to text</span></a>)</p>
</div>
<div class="section" id="exercise-4">
<h3>Exercise 4<a class="headerlink" href="#exercise-4" title="Permalink to this headline">¶</a></h3>
<p>Using the <code class="docutils literal notranslate"><span class="pre">shift</span></code> function, determine the week with the largest percent change
in the volume of trades (the <code class="docutils literal notranslate"><span class="pre">&quot;Volume</span> <span class="pre">(BTC)&quot;</span></code> column).</p>
<p>Repeat the analysis at the bi-weekly and monthly frequencies.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>We have data at a <em>daily</em> frequency and one week is <code class="docutils literal notranslate"><span class="pre">7</span></code> days.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Approximate a month by 30 days.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
<p>(<a class="reference internal" href="#pd-tim-dir4"><span class="std std-ref">back to text</span></a>)</p>
</div>
<div class="section" id="exercise-5">
<h3>Exercise 5<a class="headerlink" href="#exercise-5" title="Permalink to this headline">¶</a></h3>
<p>Imagine that you have access to the <a class="reference external" href="https://en.wikipedia.org/wiki/DeLorean_time_machine">DeLorean time machine</a>
from “Back to the Future”.</p>
<p>You are allowed to use the DeLorean only once, subject to the following
conditions:</p>
<ul class="simple">
<li><p>You may travel back to any day in the past.</p></li>
<li><p>On that day, you may purchase one bitcoin <em>at market open</em>.</p></li>
<li><p>You can then take the time machine 30 days into the future and sell your bitcoin <em>at market close</em>.</p></li>
<li><p>Then you return to the present, pocketing the profits.</p></li>
</ul>
<p>How would you pick the day?</p>
<p>Think carefully about what you would need to compute to make the
optimal choice. Try writing it out in the markdown cell below so you
have a clear description of the <em>want</em> operator that we will apply after
the exercise.</p>
<p>(Note: <strong>Don’t</strong> look too far below, because in the next non-empty cell
we have written out our answer.)</p>
<p>To make this decision, we want to know …</p>
<p><strong>Your answer here</strong></p>
<p>(<a class="reference internal" href="#pd-tim-dir5"><span class="std std-ref">back to text</span></a>)</p>
</div>
<div class="section" id="exercise-6">
<h3>Exercise 6<a class="headerlink" href="#exercise-6" title="Permalink to this headline">¶</a></h3>
<p>Do the following:</p>
<ol class="simple">
<li><p>Write a pandas function that implements your strategy.</p></li>
<li><p>Pass it to the <code class="docutils literal notranslate"><span class="pre">agg</span></code> method of <code class="docutils literal notranslate"><span class="pre">rolling_btc</span></code>.</p></li>
<li><p>Extract the <code class="docutils literal notranslate"><span class="pre">&quot;Open&quot;</span></code> column from the result.</p></li>
<li><p>Find the date associated with the maximum value in that column.</p></li>
</ol>
<p>How much money did you make? Compare with your neighbor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">daily_value</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># DELETE `pass` below and replace it with your code</span>
    <span class="k">pass</span>

<span class="n">rolling_btc</span> <span class="o">=</span> <span class="n">btc_usd</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s2">&quot;30d&quot;</span><span class="p">)</span>

<span class="c1"># do steps 2-4 here</span>
</pre></div>
</div>
</div>
</div>
<p>(<a class="reference internal" href="#pd-tim-dir6"><span class="std std-ref">back to text</span></a>)</p>
</div>
<div class="section" id="exercise-7">
<h3>Exercise 7<a class="headerlink" href="#exercise-7" title="Permalink to this headline">¶</a></h3>
<p>Now suppose you still have access to the DeLorean, but the conditions are
slightly different.</p>
<p>You may now:</p>
<ul class="simple">
<li><p>Travel back to the <em>first day</em> of any month in the past.</p></li>
<li><p>On that day, you may purchase one bitcoin <em>at market open</em>.</p></li>
<li><p>You can then travel to any day <em>in that month</em> and sell the bitcoin <em>at market close</em>.</p></li>
<li><p>Then return to the present, pocketing the profits.</p></li>
</ul>
<p>To which month would you travel? On which day of that month would you return
to sell the bitcoin?</p>
<p>Discuss with your neighbor what you would need to compute to make the
optimal choice. Try writing it out in the markdown cell below so you
have a clear description of the <em>want</em> operator that we will apply after
the exercise.</p>
<p>(Note: <strong>Don’t</strong> look too many cells below, because we have written out
our answer.)</p>
<p>To make the optimal decision we need …</p>
<p><strong>Your answer here</strong></p>
<p>(<a class="reference internal" href="#pd-tim-dir7"><span class="std std-ref">back to text</span></a>)</p>
</div>
<div class="section" id="exercise-8">
<h3>Exercise 8<a class="headerlink" href="#exercise-8" title="Permalink to this headline">¶</a></h3>
<p>Do the following:</p>
<ol class="simple">
<li><p>Write a pandas function that implements your strategy.</p></li>
<li><p>Pass it to the <code class="docutils literal notranslate"><span class="pre">agg</span></code> method of <code class="docutils literal notranslate"><span class="pre">resampled_btc</span></code>.</p></li>
<li><p>Extract the <code class="docutils literal notranslate"><span class="pre">&quot;Open&quot;</span></code> column from the result.</p></li>
<li><p>Find the date associated with the maximum value in that column.</p></li>
</ol>
<p>How much money did you make? Compare with your neighbor.</p>
<p>Was this strategy more profitable than the previous one? By how much?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">monthly_value</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># DELETE `pass` below and replace it with your code</span>
    <span class="k">pass</span>

<span class="n">resampled_btc</span> <span class="o">=</span> <span class="n">btc_usd</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span>

<span class="c1"># Do steps 2-4 here</span>
</pre></div>
</div>
</div>
</div>
<p>(<a class="reference internal" href="#pd-tim-dir8"><span class="std std-ref">back to text</span></a>)</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./pandas"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="sidebar bd-sidebar inactive persistent" id="site-navigation">

                <div class="sidebar__header">


                    Contents

                </div>

                <nav class="sidebar__nav" id="sidebar-nav" aria-label="Main navigation">
                    <ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../introduction/index.html">
   Introduction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../introduction/overview.html">
     Course Description
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../introduction/getting_started.html">
     Getting Started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../introduction/cloud_setup.html">
     Cloud Setup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../introduction/local_install.html">
     Local Installation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../introduction/troubleshooting.html">
     Troubleshooting
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../python_fundamentals/index.html">
   Python Fundamentals
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../python_fundamentals/basics.html">
     Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python_fundamentals/collections.html">
     Collections
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python_fundamentals/control_flow.html">
     Control Flow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python_fundamentals/functions.html">
     Functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../scientific/index.html">
   Scientific Computing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/numpy_arrays.html">
     Introduction to Numpy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/plotting.html">
     Plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/applied_linalg.html">
     Applied Linear Algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/randomness.html">
     Randomness
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/optimization.html">
     Optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children active">
  <a class="reference internal" href="index.html">
   pandas
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="intro.html">
     Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="basics.html">
     Basic Functionality
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="the_index.html">
     The Index
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="storage_formats.html">
     Storage Formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="data_clean.html">
     Cleaning Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="reshape.html">
     Reshape
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="merge.html">
     Merge
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="groupby.html">
     GroupBy
    </a>
   </li>
   <li class="toctree-l2 current active active">
    <a class="current reference internal" href="#">
     Time series
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="matplotlib.html">
     Intermediate Plotting
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../applications/index.html">
   Applications
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../applications/visualization_rules.html">
     Data Visualization: Rules and Guidelines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../applications/regression.html">
     Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../applications/recidivism.html">
     Case Study: Recidivism
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../applications/maps.html">
     Mapping in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../applications/classification.html">
     Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../applications/working_with_text.html">
     Working with Text
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../applications/ml_in_economics.html">
     Machine Learning in Economics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../applications/heterogeneity.html">
     Heterogeneous Effects
    </a>
   </li>
  </ul>
 </li>
</ul>

                </nav>

                <div class="sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="toolbar">

            <div class="toolbar__inner">

                <ul class="toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="../index.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                    <!-- <li class="btn__search">
                        <form action="../search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off">
                            <i data-feather="search"></i>
                        </form>
                    </li> -->
                </ul>

                <ul class="toolbar__links">
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/pandas/timeseries.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-datascience.myst/tree/main/lectures/pandas/timeseries.md" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://mybinder.org/v2/gh/QuantEcon/lecture-datascience.notebooks/main?urlpath=tree/pandas/timeseries.ipynb">BinderHub</option>
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-datascience.notebooks/blob/main/pandas/timeseries.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-datascience.notebooks" data-urlpath="tree/lecture-datascience.notebooks/pandas/timeseries.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://mybinder.org/v2/gh/QuantEcon/lecture-datascience.notebooks/main?urlpath=tree/pandas/timeseries.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "pandas/timeseries";
                const repoURL = "https://github.com/QuantEcon/lecture-datascience.notebooks";
                const urlPath = "tree/lecture-datascience.notebooks/pandas/timeseries.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-54984338-5', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>